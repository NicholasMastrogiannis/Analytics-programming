---
title: "assignment Markdown"
author: "nicholas Mastrogiannis"
date: "2025-10-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Analytics programming Assignment
#### Nicholas Mastrogiannis 22130490
#### COMP1013 Analytics Programming
## Declaration
##### By including this statement, we the authors of this work, verify that:

• We hold a copy of this assignment that we can produce if the original is lost or damaged.

• We hereby certify that no part of this assignment/product has been copied from any other student's work or from any other source except where due acknowledgement is made in the assignment.

• No part of this assignment/product has been written/produced for us by another person except
where such collaboration has been authorised by the subject lecturer/tutor concerned.

• We are aware that this work may be reproduced and submitted to plagiarism detection software programs for the purpose of detecting possible plagiarism which may retain a copy on its database for future plagiarism checking).

• We hereby certify that we have read and understand what the School of Computing, Engineering and Mathematics defines as minor and substantial breaches of misconduct as outlined in the learning guide for this unit.

## Load data for Later use.

```{r}
patient_data <- read.csv("patientsUG.csv")
encounters_data <- read.csv("encountersUG.csv")
conditions_data <- read.csv("conditionsUG.csv")
```

## Task 1 Write the code to analyse the distribution of COVID patients (confirmed or suspected) across counties And code to investigate the distribution of patients across age groups (e.g., 0-18,
19-35, 36-50, 51+). Visualise both the findings using the histogram. Explain your findings.

```{r}
#load libraries
library(dplyr)
library(ggplot2)
library(lubridate)
library(readr)

```

```{r}
#Identify COVID patients based on diagnosis description
covid_patients <- conditions_data |>
  filter(grepl("COVID|SARS|coronavirus", DESCRIPTION, ignore.case = TRUE)) |>
  distinct(PATIENT)

# Join with patient demographic data to figure out Id
covid_data <- patient_data |>
  inner_join(covid_patients, by = c("Id" = "PATIENT"))

#Calculate current age for each patient
patient_data <- patient_data |>
  mutate(
    BIRTHDATE = as.Date(BIRTHDATE),
    age = as.numeric(floor((Sys.Date() - BIRTHDATE) / 365.25)),
    age_group = case_when(
      age <= 18 ~ "0-18",
      age <= 35 ~ "19-35",
      age <= 50 ~ "36-50",
      age > 50  ~ "51+",
      TRUE ~ NA_character_
    )
  )
# Merging age groups with COVID data
covid_data <- covid_data |>
  left_join(select(patient_data, Id, age_group), by = "Id")

```

### Visualisation 1: COVID distribution across counties

```{r}
ggplot(covid_data, aes(x = COUNTY)) +
  geom_bar(fill = "steelblue") +
  labs(
    title = "Distribution of COVID Patients Across Counties",
    x = "County",
    y = "Number of Patients"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### Visualisation 2: Patient distribution across age groups

```{r}
ggplot(patient_data, aes(x = age_group)) +
  geom_bar(fill = "darkorange") +
  labs(
    title = "Distribution of Patients Across Age Groups",
    x = "Age Group",
    y = "Number of Patients"
  ) +
  theme_minimal()
```

### Understanding the task
```{r}
#The task requires identifying COVID-19–related patients from the health datasets and analyzing how they are distributed across counties and age groups (0–18, 19–35, 36–50, 51+). It also asks for correct data wrangling, clean R code, and interpretation supported by visualizations.
```

### Rationale
```{r}
#Used tidyverse packages (dplyr, ggplot2, lubridate) for consistent and readable analysis.
#Filtered conditions_data for keywords like COVID, SARS, or coronavirus.
#Joined with patient_data to access demographics.
#Calculated age and grouped into categories for population analysis.
#Used histograms for clear visual comparison.
```

### Findings and interpretation

```{r}
#COVID by County: Certain counties had noticeably higher case counts, likely due to population size or access to testing facilities.
#Patients by Age Group: Middle-aged (19–35) and older (51+) groups were most represented, indicating higher healthcare interaction in these populations.
```

## Task 2 Filter those patients in the dataset that have contracted COVID-19 or Suspected COVID-19
what are the top 5 most common conditions other than COVID-19 (symptoms) related to the patients?
Do the conditions differ between genders? Provide a table to rank the top 10 conditions for male
and female patients separately (Use kable package is encouraged). Elaborate on the findings.

```{r}

 
#Detect relevant column names dynamically 
id_col <- names(patient_data)[grepl("^Id$", names(patient_data), ignore.case = TRUE)]
patient_col <- names(conditions_data)[grepl("^patient$", names(conditions_data), ignore.case = TRUE)]
desc_col <- names(conditions_data)[grepl("desc", names(conditions_data), ignore.case = TRUE)]


# Filter all conditions for COVID patients 
covid_conditions <- conditions_data |>
  rename(PATIENT = all_of(patient_col)) |>
  semi_join(covid_patients, by = "PATIENT") |>
  filter(!grepl("COVID|SARS|coronavirus", .data[[desc_col]], ignore.case = TRUE))

# Join with gender information 
covid_conditions_gender <- covid_conditions |>
  left_join(patient_data |> rename(Id = all_of(id_col)), by = c("PATIENT" = "Id"))

# Count and rank conditions by gender 
condition_rank <- covid_conditions_gender |>
  group_by(GENDER, .data[[desc_col]]) |>
  summarise(count = n(), .groups = "drop") |>
  arrange(GENDER, desc(count))

# Create top 10 conditions per gender 
top_conditions <- condition_rank |>
  group_by(GENDER) |>
  slice_max(order_by = count, n = 10) |>
  mutate(rank = row_number()) |>
  select(GENDER, rank, condition = all_of(desc_col), count)

```

```{r}
# Display tables using kable 
library(knitr)

# Display tables using kable
top_conditions |>
  group_split(GENDER) |>
  lapply(\(df) {
    cat("\n### Top 10 Conditions for Gender:", unique(df$GENDER), "\n")
    print(kable(df, caption = paste("Top 10 Conditions for", unique(df$GENDER), "PATIENTS")))   })
```

## Understanding the task

```{r}
# The task involves identifying patients diagnosed with confirmed or suspected COVID-19 and analyzing their most common additional (non-COVID) conditions. It also examines whether these conditions differ between male and female patients and requires presenting the top 10 ranked conditions for each gender using kable.
```

## Rationale
```{r}
#Used tidyverse for efficient data filtering and joining.
#Extracted COVID-positive patients from conditions_data using keywords such as COVID, SARS, or coronavirus.
#Excluded COVID-related entries to focus on other conditions.
#Joined with patient_data to access gender information.
#Summarized and ranked conditions by gender and displayed results using kable() for clear presentation.
```

## Findings and Interpretation

```{r}
#Common non-COVID conditions included respiratory symptoms (e.g., pneumonia, fever, cough) and chronic illnesses such as hypertension and diabetes.
#Gender differences emerged — males showed more cardiovascular and metabolic conditions, while females displayed slightly higher fatigue and immune-related issues.
```

