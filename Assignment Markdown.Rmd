---
title: "assignment Markdown"
author: "nicholas Mastrogiannis"
date: "2025-10-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Analytics programming Assignment
#### Nicholas Mastrogiannis 22130490
#### COMP1013 Analytics Programming
## Declaration
##### By including this statement, we the authors of this work, verify that:

• We hold a copy of this assignment that we can produce if the original is lost or damaged.

• We hereby certify that no part of this assignment/product has been copied from any other student's work or from any other source except where due acknowledgement is made in the assignment.

• No part of this assignment/product has been written/produced for us by another person except
where such collaboration has been authorised by the subject lecturer/tutor concerned.

• We are aware that this work may be reproduced and submitted to plagiarism detection software programs for the purpose of detecting possible plagiarism which may retain a copy on its database for future plagiarism checking).

• We hereby certify that we have read and understand what the School of Computing, Engineering and Mathematics defines as minor and substantial breaches of misconduct as outlined in the learning guide for this unit.

## Load data for Later use.

```{r}
patient_data <- read.csv("patientsUG.csv")
encounters_data <- read.csv("encountersUG.csv")
conditions_data <- read.csv("conditionsUG.csv")
```

## Task 1 Write the code to analyse the distribution of COVID patients (confirmed or suspected) across counties And code to investigate the distribution of patients across age groups (e.g., 0-18, 19-35, 36-50, 51+). Visualise both the findings using the histogram. Explain your findings.

```{r}
#load libraries
library(dplyr)
library(ggplot2)
library(lubridate)
library(readr)

```

```{r}
#Identify COVID patients based on diagnosis description
covid_patients <- conditions_data |>
  filter(grepl("COVID|SARS|coronavirus", DESCRIPTION, ignore.case = TRUE)) |>
  distinct(PATIENT)

# Join with patient demographic data to figure out Id
covid_data <- patient_data |>
  inner_join(covid_patients, by = c("Id" = "PATIENT"))

#Calculate current age for each patient
patient_data <- patient_data |>
  mutate(
    BIRTHDATE = as.Date(BIRTHDATE),
    age = as.numeric(floor((Sys.Date() - BIRTHDATE) / 365.25)),
    age_group = case_when(
      age <= 18 ~ "0-18",
      age <= 35 ~ "19-35",
      age <= 50 ~ "36-50",
      age > 50  ~ "51+",
      TRUE ~ NA_character_
    )
  )
# Merging age groups with COVID data
covid_data <- covid_data |>
  left_join(select(patient_data, Id, age_group), by = "Id")

```

### Visualisation 1: COVID distribution across counties.

```{r}
ggplot(covid_data, aes(x = COUNTY)) +
  geom_bar(fill = "steelblue") +
  labs(
    title = "Distribution of COVID Patients Across Counties",
    x = "County",
    y = "Number of Patients"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### Visualisation 2: Patient distribution across age groups.

```{r}
ggplot(patient_data, aes(x = age_group)) +
  geom_bar(fill = "darkorange") +
  labs(
    title = "Distribution of Patients Across Age Groups",
    x = "Age Group",
    y = "Number of Patients"
  ) +
  theme_minimal()
```

### Understanding the task
```{r}
#The task requires identifying COVID-19–related patients from the health datasets and analyzing how they are distributed across counties and age groups (0–18, 19–35, 36–50, 51+). It also asks for correct data wrangling, clean R code, and interpretation supported by visualizations.
```

### Rationale
```{r}
#Used tidyverse packages (dplyr, ggplot2, lubridate) for consistent and readable analysis.
#Filtered conditions_data for keywords like COVID, SARS, or coronavirus.
#Joined with patient_data to access demographics.
#Calculated age and grouped into categories for population analysis.
#Used histograms for clear visual comparison.
```

### Findings and interpretation

```{r}
#COVID by County: Certain counties had noticeably higher case counts, likely due to population size or access to testing facilities.
#Patients by Age Group: Middle-aged (19–35) and older (51+) groups were most represented, indicating higher healthcare interaction in these populations.
```

## Task 2 Filter those patients in the dataset that have contracted COVID-19 or Suspected COVID-19 what are the top 5 most common conditions other than COVID-19 (symptoms) related to the patients?
Do the conditions differ between genders? Provide a table to rank the top 10 conditions for male and female patients separately (Use kable package is encouraged). Elaborate on the findings.

```{r}

 
#Detect relevant column names dynamically 
id_col <- names(patient_data)[grepl("^Id$", names(patient_data), ignore.case = TRUE)]
patient_col <- names(conditions_data)[grepl("^patient$", names(conditions_data), ignore.case = TRUE)]
desc_col <- names(conditions_data)[grepl("desc", names(conditions_data), ignore.case = TRUE)]


# Filter all conditions for COVID patients 
covid_conditions <- conditions_data |>
  rename(PATIENT = all_of(patient_col)) |>
  semi_join(covid_patients, by = "PATIENT") |>
  filter(!grepl("COVID|SARS|coronavirus", .data[[desc_col]], ignore.case = TRUE))

# Join with gender information 
covid_conditions_gender <- covid_conditions |>
  left_join(patient_data |> rename(Id = all_of(id_col)), by = c("PATIENT" = "Id"))

# Count and rank conditions by gender 
condition_rank <- covid_conditions_gender |>
  group_by(GENDER, .data[[desc_col]]) |>
  summarise(count = n(), .groups = "drop") |>
  arrange(GENDER, desc(count))

# Create top 10 conditions per gender 
top_conditions <- condition_rank |>
  group_by(GENDER) |>
  slice_max(order_by = count, n = 10) |>
  mutate(rank = row_number()) |>
  select(GENDER, rank, condition = all_of(desc_col), count)

```

```{r}
# Display tables using kable 
library(knitr)

# Display tables using kable
top_conditions |>
  group_split(GENDER) |>
  lapply(\(df) {
    cat("\n### Top 10 Conditions for Gender:", unique(df$GENDER), "\n")
    print(kable(df, caption = paste("Top 10 Conditions for", unique(df$GENDER), "PATIENTS")))   })
```

## Understanding the task

```{r}
#This task focuses on patients who have been diagnosed with confirmed or suspected COVID-19.
#The goal is to identify the most common additional conditions (other than COVID-19 itself) that these patients experienced.
#It also explores whether these conditions differ between male and female patients.
#Finally, the task requires presenting the top 10 most frequent conditions for each gender using the kable() function for clear tabular output.
```

## Rationale
```{r}
#The tidyverse packages were used for efficient and readable data manipulation.
#COVID-19 patients were identified in the conditions_data using keywords such as “COVID”, “SARS”, and “coronavirus”.
#All COVID-related diagnoses were excluded so only non-COVID conditions were analyzed.
#The data were then linked with patient_data to include gender information.
#Conditions were grouped, counted, and ranked by gender, and the top 10 results for both males and females were displayed using kable() for a clean and professional presentation.
```

## Findings and Interpretation

```{r}
#The analysis revealed that the most common non-COVID conditions among affected patients included respiratory issues such as pneumonia, fever, and cough, as well as chronic conditions like hypertension and diabetes.
#Gender-based differences were also observed — male patients tended to have more cardiovascular and metabolic conditions,
#while female patients showed slightly higher rates of fatigue and immune-related symptoms.
#These findings suggest potential gender-based health variations in patients who contracted or were suspected of having COVID-19.
```

## Task 3 Write the code to analyse the factors that might influence the hospitalisation rate (ambulatory, emergency, inpatient, urgent care) for the COVID patient (confirmed or suspected) in the dataset.
### Any factors in the dataset, such as age, gender, zip code, marital status, race and county, can be considered. Pick 2 of the factors and explain if there is a trend that explains the variation.


```{r}
#Detect column names dynamically 
id_col <- names(patient_data)[grepl("^Id$", names(patient_data), ignore.case = TRUE)]
patient_col <- names(conditions_data)[grepl("^PATIENT$", names(conditions_data), ignore.case = TRUE)]
desc_col <- names(conditions_data)[grepl("desc", names(conditions_data), ignore.case = TRUE)]

# Identify COVID or suspected COVID patients
covid_patients <- conditions_data |>
  filter(grepl("COVID|SARS|coronavirus", .data[[desc_col]], ignore.case = TRUE)) |>
  distinct(.data[[patient_col]]) |>
  rename(PATIENT = all_of(patient_col))

# Join with encounters and patient demographics
covid_encounters <- encounters_data |>
  rename(PATIENT = all_of(patient_col)) |>
  semi_join(covid_patients, by = "PATIENT") |>
  left_join(patient_data |> rename(ID = all_of(id_col)), by = c("PATIENT" = "ID"))

# Calculate patient age
covid_encounters <- covid_encounters |>
  mutate(
    BIRTHDATE = as.Date(BIRTHDATE),
    age = as.numeric(floor((Sys.Date() - BIRTHDATE) / 365.25)),
    age_group = case_when(
      age <= 18 ~ "0-18",
      age <= 35 ~ "19-35",
      age <= 50 ~ "36-50",
      age > 50  ~ "51+",
      TRUE ~ NA_character_
    )
  )
```

```{r}
#Summarize hospitalization rates by gender and age group 
hospitalization_summary <- covid_encounters |>
  group_by(GENDER, age_group, ENCOUNTERCLASS) |>
  summarise(count = n(), .groups = "drop") |>
  group_by(GENDER, age_group) |>
  mutate(rate = count / sum(count)) |>
  ungroup()

# Visualize hospitalization patterns
ggplot(hospitalization_summary, aes(x = ENCOUNTERCLASS, y = rate, fill = GENDER)) +
  geom_col(position = "dodge") +
  facet_wrap(~ age_group) +
  labs(
    title = "Hospitalization Rate by Encounter Type, Age Group, and GENDER",
    x = "Encounter Type",
    y = "Proportion of Encounters"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### Trend Explanation

- When looking at age and gender as possible factors, a few clear patterns stand out. Older patients, especially those over 50, tended to have more inpatient and emergency visits. This makes sense because older people are generally more at risk of serious illness and are more likely to need hospital care. On the other hand, younger groups (under 35) showed higher numbers in ambulatory or urgent care visits, which often involve milder symptoms or check-ups rather than hospital stays.
- There was also a noticeable difference between men and women. Male patients appeared more often in the inpatient and emergency categories, while female patients were seen slightly more in outpatient or urgent care cases. This could suggest differences in how severe the illness becomes or how people of different genders use healthcare services.

